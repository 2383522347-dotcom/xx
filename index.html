<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#f4efe6">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>æœºç”µä¸€ä½“åŒ–è‹±æ–‡å­¦ä¹ </title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“–</text></svg>">
  <style>
    :root {
      --bg: #f4efe6;
      --bg-soft: #ebe6df;
      --card: #fffcf8;
      --text: #3d3935;
      --text-muted: #6b6560;
      --accent: #5a8fb4;
      --accent-soft: #7ba8c4;
      --gold: #c9a227;
      --border: #ddd8d0;
      --radius: 12px;
      --font: "Segoe UI", "Microsoft YaHei", "PingFang SC", sans-serif;
      --ease: cubic-bezier(0.35, 0.1, 0.25, 1);
      --ease-out: cubic-bezier(0.2, 0.8, 0.3, 1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font); background: var(--bg); color: var(--text);
      min-height: 100vh; min-height: 100dvh;
      transition: background 0.4s var(--ease), color 0.3s var(--ease);
      -webkit-tap-highlight-color: transparent;
    }
    .header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 14px 22px; background: var(--card); border-bottom: 1px solid var(--border);
      flex-wrap: wrap; gap: 12px;
      transition: background 0.3s var(--ease), border-color 0.3s var(--ease);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .header-left { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; font-size: 13px; }
    .header-left .stat { color: var(--text-muted); transition: color 0.25s var(--ease); }
    .header-left .stat strong { color: var(--text); margin-left: 4px; transition: color 0.25s var(--ease); }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .btn {
      padding: 10px 18px; min-height: 44px; min-width: 44px;
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); cursor: pointer; font-size: 13px;
      transition: border-color 0.25s var(--ease), color 0.25s var(--ease), background 0.25s var(--ease), transform 0.2s var(--ease);
      display: inline-flex; align-items: center; justify-content: center;
    }
    .btn:hover { border-color: var(--accent); color: var(--accent); background: var(--bg-soft); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .main { max-width: 900px; margin: 0 auto; padding: 28px; transition: padding 0.3s var(--ease); }
    .page {
      display: none; opacity: 0; visibility: hidden;
      transition: opacity 0.35s var(--ease), visibility 0.35s var(--ease), transform 0.35s var(--ease);
      transform: translateY(8px);
    }
    .page.active {
      display: block; opacity: 1; visibility: visible; transform: translateY(0);
      animation: pageIn 0.4s var(--ease-out) forwards;
    }
    @keyframes pageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .grid-3x3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
    .module-card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 26px; cursor: pointer; text-align: center;
      transition: all 0.3s var(--ease); box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .module-card:hover {
      border-color: var(--accent-soft); transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    .module-card:active { transform: translateY(-2px); }
    .module-card h3 { font-size: 16px; margin-bottom: 8px; transition: color 0.25s var(--ease); }
    .module-card p { font-size: 12px; color: var(--text-muted); transition: color 0.25s var(--ease); }
    .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 22px; transition: opacity 0.3s var(--ease); }
    .word-card-box {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 36px; max-width: 480px; margin: 24px auto;
      transition: all 0.35s var(--ease); box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    .word-card-box .word-en { font-size: 24px; font-weight: 600; margin-bottom: 8px; cursor: pointer; transition: color 0.25s var(--ease); }
    .word-card-box .word-en:hover { color: var(--accent); }
    .word-card-box .word-phonetic { font-size: 14px; color: var(--text-muted); margin-bottom: 12px; transition: color 0.25s var(--ease); }
    .word-card-box .word-cn { font-size: 16px; color: var(--accent); transition: color 0.25s var(--ease); }
    .word-memory-tip { font-size: 11px; color: var(--text-muted); margin-top: 12px; padding: 8px 12px; background: var(--bg-soft); border-radius: 8px; line-height: 1.4; }
    .word-actions { display: flex; gap: 12px; margin-top: 24px; justify-content: center; flex-wrap: wrap; }
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; z-index: 1000;
      opacity: 0; visibility: hidden; pointer-events: none;
      transition: opacity 0.3s var(--ease), visibility 0.3s var(--ease);
    }
    .modal-overlay:not(.hide) { opacity: 1; visibility: visible; pointer-events: auto; }
    .modal-overlay.hide { display: flex; }
    .modal-box {
      background: var(--card); padding: 26px; border-radius: var(--radius); max-width: 400px; width: 90%;
      border: 1px solid var(--border); box-shadow: 0 12px 40px rgba(0,0,0,0.12);
      transform: scale(0.94); opacity: 0;
      transition: transform 0.35s var(--ease-out), opacity 0.35s var(--ease-out);
    }
    .modal-overlay:not(.hide) .modal-box { transform: scale(1); opacity: 1; }
    .modal-box h3 { margin-bottom: 16px; font-size: 16px; transition: color 0.25s var(--ease); }
    .modal-close { float: right; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 20px; transition: color 0.25s var(--ease), transform 0.2s var(--ease); }
    .modal-close:hover { color: var(--text); transform: scale(1.1); }
    .learn-list { margin-top: 16px; }
    .learn-item {
      padding: 12px 14px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center; cursor: pointer;
      transition: background 0.25s var(--ease), padding 0.2s var(--ease);
    }
    .learn-item:hover { background: var(--bg-soft); padding-left: 18px; }
    select, input[type="text"], input[type="password"], textarea {
      padding: 10px 14px; border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); width: 100%; max-width: 320px; margin-bottom: 12px;
      transition: border-color 0.25s var(--ease), box-shadow 0.25s var(--ease);
    }
    select:focus, input:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(90, 143, 180, 0.15); }
    .dialogue-result { margin-top: 16px; padding: 16px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--bg-soft); }
    .dialogue-result.correct { border-color: #2d8a5e; }
    .dialogue-result.wrong { border-color: #c45c4a; }
    .test-result-item { padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px; transition: color 0.25s var(--ease); }
    .test-result-item.correct { color: #2d8a5e; }
    .test-result-item.wrong { color: #c45c4a; }
    .coins { color: var(--gold); font-weight: 600; transition: color 0.25s var(--ease); }
    .hide { display: none !important; }
    /* å•†åŸå•†å“å¡ç‰‡ */
    .mall-product { background: var(--bg-soft); border-radius: var(--radius); padding: 16px; margin-bottom: 16px; border: 1px solid var(--border); }
    .mall-product-img { width: 80px; height: 80px; border-radius: 8px; background: var(--card); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; margin-bottom: 8px; transition: transform 0.2s var(--ease); }
    .mall-product-img:hover { transform: scale(1.05); }
    .mall-product-name { font-weight: 600; margin-bottom: 4px; }
    .mall-product-price { font-size: 13px; color: var(--gold); margin-bottom: 10px; }
    .mall-product-qty { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 10px; }
    .mall-product-qty .btn { padding: 6px 14px; min-height: 36px; min-width: 36px; }
    .mall-product-qty span { min-width: 28px; text-align: center; font-weight: 600; }
    .mall-product-buy { display: block; width: 100%; text-align: center; }
    /* èµ„æ–™å¡å¼¹çª—ï¼ˆä¸æ¸¸æˆå†…èµ„æ–™å¡ä¸€è‡´ï¼‰ */
    .product-card-box { max-width: 360px; box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
    .product-card-box .modal-close { position: absolute; top: 12px; right: 12px; margin: 0; }
    .product-card-title { font-size: 16px; font-weight: 600; margin-bottom: 14px; padding-right: 28px; }
    .product-card-header { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; padding: 14px; background: var(--bg-soft); border-radius: 10px; border: 1px solid var(--border); }
    .product-card-img { width: 72px; height: 72px; border-radius: 10px; background: var(--card); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 40px; flex-shrink: 0; box-shadow: inset 0 1px 2px rgba(0,0,0,0.04); }
    .product-card-meta { flex: 1; min-width: 0; }
    .product-card-meta .product-card-row { display: flex; align-items: center; justify-content: space-between; font-size: 14px; margin-bottom: 6px; }
    .product-card-meta .product-card-row:last-child { margin-bottom: 0; }
    .product-card-meta .coins { font-size: 16px; color: var(--gold); }
    .product-card-meta .maturity-label { color: var(--text-muted); }
    .product-card-section { margin-top: 14px; padding: 12px 14px; background: var(--bg-soft); border-radius: 8px; border: 1px solid var(--border); }
    .product-card-section h4 { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.02em; }
    .product-card-section p { font-size: 14px; line-height: 1.55; margin: 0; color: var(--text); }
    /* é‡‘å¸ä¸è¶³æç¤º */
    .toast-mall { position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%); background: rgba(0,0,0,0.85); color: #fff; padding: 14px 24px; border-radius: var(--radius); z-index: 1100; font-size: 14px; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; }
    .toast-mall.show { opacity: 1; visibility: visible; }
    /* æµ‹è¯•ç­”é¢˜ï¼šå•è¯å¡ + è¿›åº¦ */
    .test-do-progress { text-align: center; margin-bottom: 16px; font-size: 14px; color: var(--text-muted); transition: color 0.25s var(--ease); }
    .test-do-progress strong { color: var(--text); transition: color 0.25s var(--ease); }
    .test-do-progress-bar { height: 6px; background: var(--border); border-radius: 3px; margin-top: 8px; max-width: 320px; margin-left: auto; margin-right: auto; overflow: hidden; }
    .test-do-progress-bar-inner { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.35s var(--ease); }
    .test-card-box {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 40px 32px; max-width: 480px; margin: 24px auto; text-align: center;
      transition: all 0.35s var(--ease); box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    .test-card-box .test-prompt { font-size: 22px; font-weight: 600; color: var(--text); margin-bottom: 24px; line-height: 1.4; }
    .test-card-box .test-input-wrap { margin-bottom: 20px; }
    .test-card-box .test-input-wrap input { max-width: 280px; margin: 0 auto; text-align: center; font-size: 16px; }
    .test-card-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .test-result-summary { margin-top: 24px; padding: 20px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--bg-soft); transition: all 0.35s var(--ease); }
    .home-top-bar { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 16px; }
    .word-clickable { cursor: pointer; text-decoration: underline; text-decoration-style: dotted; color: var(--text); padding: 0 1px; transition: opacity 0.25s var(--ease); }
    .word-clickable:hover { opacity: 0.75; }
    .reading-article-body { line-height: 1.9; font-size: 15px; margin: 16px 0; }
    .reading-article-body .sentence-block { margin-bottom: 14px; }
    .sentence-clickable { cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: background 0.2s var(--ease), color 0.2s var(--ease); }
    .sentence-clickable:hover { background: var(--bg-soft); color: var(--accent); }
    .reading-quiz-q { margin-bottom: 18px; padding-bottom: 14px; border-bottom: 1px solid var(--border); }
    .reading-quiz-q:last-of-type { border-bottom: none; }
    .reading-quiz-q p { margin-bottom: 8px; font-weight: 500; }
    .reading-quiz-opt { display: block; margin: 6px 0; padding: 8px 12px; border-radius: var(--radius); cursor: pointer; border: 1px solid var(--border); transition: border-color 0.2s var(--ease), background 0.2s var(--ease); }
    .reading-quiz-opt:hover { border-color: var(--accent-soft); background: var(--bg-soft); }
    .reading-quiz-opt input { margin-right: 8px; }
    #btnReadTranslation { transition: color 0.25s var(--ease), transform 0.2s var(--ease); }
    #btnReadTranslation:hover { color: var(--accent); transform: scale(1.1); }

    /* é—å¿˜å¤ä¹ ç¿»å¡ */
    .flashcard-container { perspective: 1200px; max-width: 420px; margin: 24px auto; min-height: 220px; }
    .flashcard {
      position: relative; width: 100%; min-height: 200px; cursor: pointer;
      transform-style: preserve-3d; transition: transform 0.5s var(--ease);
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard-face {
      position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
      -webkit-backface-visibility: hidden; display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 32px 24px;
      border-radius: var(--radius); box-sizing: border-box;
    }
    .flashcard-front { background: var(--card); }
    .flashcard-back { background: var(--bg-soft); transform: rotateY(180deg); }
    .flashcard-front .flashcard-prompt { font-size: 22px; font-weight: 600; color: var(--text); text-align: center; line-height: 1.4; }
    .flashcard-front .flashcard-hint { font-size: 12px; color: var(--text-muted); margin-top: 12px; }
    .flashcard-back .word-en { font-size: 22px; font-weight: 600; cursor: pointer; margin-bottom: 8px; transition: color 0.25s var(--ease); }
    .flashcard-back .word-en:hover { color: var(--accent); }
    .flashcard-back .word-phonetic { font-size: 14px; color: var(--text-muted); margin-bottom: 10px; }
    .flashcard-back .word-cn { font-size: 16px; color: var(--accent); }
    .flashcard-actions { display: flex; gap: 12px; margin-top: 24px; justify-content: center; flex-wrap: wrap; }
    .flashcard-finish-wrap { text-align: center; margin-top: 24px; padding: 20px; border-top: 1px solid var(--border); }
    .flashcard-btn-remember { margin-top: 16px; }
    .flashcard-memory-tip { font-size: 11px; color: var(--text-muted); margin-top: 16px; padding: 8px 12px; background: var(--bg-soft); border-radius: 8px; line-height: 1.4; text-align: center; }
    .flashcard-reviewed-label { display: inline-block; margin-top: 12px; font-size: 13px; color: #2d8a5e; font-weight: 500; }

    /* ç™»å½•é—¨é¡µ */
    .login-gate-box {
      max-width: 360px; margin: 60px auto; padding: 36px;
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .login-gate-box h2 { font-size: 20px; margin-bottom: 12px; text-align: center; }
    .login-gate-tip { color: var(--text-muted); font-size: 14px; margin-bottom: 24px; text-align: center; }
    .login-gate-box input { display: block; width: 100%; margin-bottom: 12px; }
    .login-gate-box .btn { margin-right: 10px; margin-top: 8px; }
    .gate-reg-error {
      display: none; margin-bottom: 12px; padding: 10px 12px;
      background: #fde8e8; border: 1px solid #e57373; border-radius: var(--radius);
      color: #c62828; font-size: 14px; line-height: 1.4;
    }
    .gate-reg-error.show { display: block; }
    .account-modal-actions { display: flex; gap: 10px; margin-top: 14px; }
    .admin-account-item { background: var(--bg-soft); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; margin-bottom: 12px; }
    .admin-account-item.frozen { border-color: #c45c4a; background: rgba(196,92,74,0.08); }
    .admin-account-item h4 { margin-bottom: 8px; font-size: 14px; }
    .admin-account-item .admin-stats { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
    .admin-account-item .admin-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* å¹³æ¿ */
    @media (max-width: 1024px) {
      .main { padding: 20px 16px; }
      .header { padding: 12px 16px; }
      .header-left, .header-right { gap: 12px; font-size: 12px; }
      .grid-3x3 { grid-template-columns: repeat(2, 1fr); gap: 14px; }
      .module-card { padding: 20px 16px; }
      .module-card h3 { font-size: 15px; }
      .word-card-box { padding: 28px 24px; margin: 20px auto; }
      .modal-box { padding: 22px; width: 92%; max-width: 420px; }
    }

    /* æ‰‹æœº */
    @media (max-width: 768px) {
      .main { padding: 16px 12px; max-width: 100%; }
      .header { padding: 10px 12px; flex-direction: column; align-items: stretch; gap: 8px; }
      .header-left { justify-content: space-between; font-size: 12px; }
      .header-right { justify-content: flex-end; flex-wrap: wrap; gap: 8px; }
      .header-right .btn { padding: 10px 14px; font-size: 12px; }
      .grid-3x3 { grid-template-columns: 1fr; gap: 12px; }
      .module-card { padding: 20px 16px; min-height: 72px; }
      .module-card h3 { font-size: 15px; margin-bottom: 6px; }
      .module-card p { font-size: 11px; }
      .top-bar { flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
      .top-bar h2 { font-size: 16px; }
      .word-card-box { padding: 24px 20px; margin: 16px auto; max-width: 100%; }
      .word-card-box .word-en { font-size: 20px; }
      .word-actions { gap: 10px; margin-top: 18px; }
      .modal-box { padding: 20px 16px; width: 94%; max-width: 100%; border-radius: 10px; }
      .modal-box h3 { font-size: 15px; }
      select, input[type="text"], input[type="password"], textarea { font-size: 16px; max-width: 100%; }
      .reading-article-body { font-size: 15px; line-height: 1.8; }
      .test-card-box { padding: 24px 16px; }
      .test-card-box .test-prompt { font-size: 18px; }
      .flashcard-container { min-height: 180px; }
      .flashcard-front .flashcard-prompt { font-size: 18px; }
      .flashcard-back .word-en { font-size: 18px; }
    }

    @media (max-width: 480px) {
      .main { padding: 12px 10px; }
      .header-left .stat { font-size: 11px; }
      .header-right .stat { font-size: 11px; }
      .module-card { padding: 18px 14px; }
      .word-card-box .word-en { font-size: 18px; }
      .word-card-box .word-cn { font-size: 14px; }
    }
  </style>
</head>
<body>
  <header class="header" id="appHeader">
    <div class="header-left">
      <span class="stat">è¿ç»­ç­¾åˆ°: <strong id="signInDays">0</strong> å¤©</span>
      <span class="stat">ä»Šæ—¥å­¦ä¹ : <strong id="studyTimeDisplay">0åˆ†0ç§’0</strong></span>
      <span class="stat">è¯æ±‡é‡: <strong id="vocabLevelDisplay">æœªæ£€æµ‹</strong></span>
    </div>
    <div class="header-right">
      <span class="stat">å·²å­¦: <strong id="learnedCount">0</strong> è¯</span>
      <button type="button" class="btn" id="btnSignIn">ç­¾åˆ°</button>
      <button type="button" class="btn" id="btnLearned">å·²å­¦ä¹ å•è¯</button>
      <button type="button" class="btn" id="btnMall">å•†åŸ</button>
      <button type="button" class="btn" id="btnAccount" onclick="if(window.openAccountModal)window.openAccountModal()">è´¦æˆ·</button>
    </div>
  </header>

  <main class="main">
    <!-- ç™»å½•é—¨ï¼šæœªç™»å½•æ—¶åªæ˜¾ç¤ºæ­¤é¡µï¼Œç™»å½•/æ³¨å†ŒæˆåŠŸåè¿›å…¥ä¸»é¡µ -->
    <div id="pageLoginGate" class="page active">
      <div class="login-gate-box">
        <script>
        (function(){
          function doGateRegister(){
            var user=(document.getElementById('gateRegUsername')&&document.getElementById('gateRegUsername').value||'').trim();
            var pwd=document.getElementById('gateRegPassword')?document.getElementById('gateRegPassword').value:'';
            var confirmPwd=document.getElementById('gateRegPasswordConfirm')?document.getElementById('gateRegPasswordConfirm').value:'';
            if(!user){ alert('æ³¨å†Œå¤±è´¥'); return; }
            if(!/^[a-zA-Z0-9]+$/.test(user)){ alert('è´¦å·åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—'); return; }
            if(!pwd){ alert('æ³¨å†Œå¤±è´¥'); return; }
            if(!/^[a-zA-Z0-9]+$/.test(pwd)){ alert('å¯†ç åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—'); return; }
            if(pwd!==confirmPwd){ alert('æ³¨å†Œå¤±è´¥'); return; }
            var raw=localStorage.getItem('mech_accounts')||'{}';
            var accounts={};
            try{ accounts=JSON.parse(raw); }catch(e){}
            if(accounts[user]){ alert('æ³¨å†Œå¤±è´¥'); return; }
            accounts[user]=pwd;
            try{ localStorage.setItem('mech_accounts',JSON.stringify(accounts)); }catch(e){ alert('æ³¨å†Œå¤±è´¥'); return; }
            document.getElementById('gateRegUsername').value='';
            document.getElementById('gateRegPassword').value='';
            document.getElementById('gateRegPasswordConfirm').value='';
            document.getElementById('gateRegisterForm').classList.add('hide');
            document.getElementById('gateLoginForm').classList.remove('hide');
            alert('æ³¨å†ŒæˆåŠŸ');
          }
          function doGateLogin(){
            var user=(document.getElementById('gateUsername')&&document.getElementById('gateUsername').value||'').trim();
            var pwd=document.getElementById('gatePassword')?document.getElementById('gatePassword').value:'';
            if(!user){ alert('è¯·è¾“å…¥è´¦å·'); return; }
            var blRaw=localStorage.getItem('mech_blacklist')||'[]';
            var blacklist=[]; try{ blacklist=JSON.parse(blRaw); }catch(e){}
            if(blacklist.indexOf(user)>=0){ alert('å·²ç»å†»ç»“'); return; }
            var raw=localStorage.getItem('mech_accounts')||'{}';
            var accounts={};
            try{ accounts=JSON.parse(raw); }catch(e){}
            if(!accounts[user]){ alert('ç™»å½•å¤±è´¥'); return; }
            if(accounts[user]!==pwd){ alert('å¯†ç é”™è¯¯'); return; }
            try{ sessionStorage.setItem('mech_account',JSON.stringify({username:user,password:pwd})); }catch(e){ alert('ç™»å½•å¤±è´¥'); return; }
            var header=document.getElementById('appHeader');
            if(header) header.style.display='';
            document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
            var home=document.getElementById('pageHome');
            if(home) home.classList.add('active');
            alert('ç™»å½•æˆåŠŸ');
          }
          window.doGateRegister=doGateRegister;
          window.doGateLogin=doGateLogin;
        })();
        </script>
        <h2>æœºç”µä¸€ä½“åŒ–è‹±æ–‡å­¦ä¹ </h2>
        <p class="login-gate-tip">è¯·å…ˆç™»å½•æˆ–æ³¨å†Œåå†è¿›è¡Œå­¦ä¹ </p>
        <p id="gateSyncHint" class="login-gate-tip" style="margin-top:8px;font-size:12px;color:var(--text-muted);display:none;"></p>
        <div id="gateLoginForm">
          <input type="text" id="gateUsername" placeholder="è´¦å·">
          <input type="password" id="gatePassword" placeholder="å¯†ç ">
          <button type="button" class="btn" id="gateBtnLogin">ç™»å½•</button>
          <button type="button" class="btn" id="gateBtnShowRegister" onclick="var f=document.getElementById('gateLoginForm'); var r=document.getElementById('gateRegisterForm'); if(f&&r){ f.classList.add('hide'); r.classList.remove('hide'); document.getElementById('gateRegUsername').value=''; document.getElementById('gateRegPassword').value=''; document.getElementById('gateRegPasswordConfirm').value=''; }">æ³¨å†Œ</button>
        </div>
        <div id="gateRegisterForm" class="hide">
          <p class="login-gate-tip" style="margin-bottom:16px;">è´¦å·ä¸å¯†ç åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—ï¼Œä¸¤éå¯†ç ä¸€è‡´åå¯ç‚¹å‡»æ³¨å†Œ</p>
          <div id="gateRegError" class="gate-reg-error"></div>
          <input type="text" id="gateRegUsername" placeholder="è´¦å·ï¼ˆä»…è‹±æ–‡ã€æ•°å­—ï¼‰">
          <input type="password" id="gateRegPassword" placeholder="å¯†ç ï¼ˆä»…è‹±æ–‡ã€æ•°å­—ï¼‰">
          <input type="password" id="gateRegPasswordConfirm" placeholder="ç¡®è®¤å¯†ç ">
          <button type="button" class="btn" id="gateBtnRegister">æ³¨å†Œ</button>
          <button type="button" class="btn" id="gateBtnShowLogin" onclick="var f=document.getElementById('gateLoginForm'); var r=document.getElementById('gateRegisterForm'); if(f&&r){ r.classList.add('hide'); f.classList.remove('hide'); }">è¿”å›ç™»å½•</button>
        </div>
      </div>
    </div>

    <!-- ä¸»é¡µ 3x3 -->
    <div id="pageHome" class="page">
      <div class="home-top-bar">
        <button type="button" class="btn" id="btnSearch">æœç´¢</button>
      </div>
      <div class="grid-3x3" id="mainGrid">
        <div class="module-card" data-module="wordLearn"><h3>å•è¯å­¦ä¹ </h3><p>é€‰æ‹©å•è¯æœ¬å­¦ä¹ </p></div>
        <div class="module-card" data-module="scenario"><h3>æƒ…æ™¯å¯¹è¯</h3><p>è¾“å…¥è‹±æ–‡ï¼Œæ™ºèƒ½åˆ¤æ–­</p></div>
        <div class="module-card" data-module="wordTest"><h3>å•è¯æµ‹è¯•</h3><p>é€‰æ‹©å•è¯æœ¬ï¼Œéšæœº50é¢˜</p></div>
        <div class="module-card" data-module="basicWord"><h3>åŸºç¡€å•è¯å­¦ä¹ </h3><p>å°å­¦/åˆä¸­/é«˜ä¸­/å¤§å­¦/å‡ºå›½/é›…æ€/æ‰˜ç¦/å“ˆä½›</p></div>
        <div class="module-card" data-module="vocabTest"><h3>å•è¯è¯æ±‡é‡æ£€æµ‹</h3><p>50é¢˜æ ¹æ®æ­£ç¡®ç‡å®šçº§</p></div>
        <div class="module-card" data-module="recommend"><h3>æ¨èå­¦ä¹ </h3><p>æ ¹æ®ç­‰çº§æ¨èå•è¯</p></div>
        <div class="module-card" data-module="reading"><h3>è‹±è¯­é˜…è¯»</h3><p>åˆ†çº§é˜…è¯»Â·è¯»åæµ‹éªŒÂ·è¾¾æ ‡å¾—600é‡‘å¸</p></div>
      </div>
    </div>

    <!-- å•è¯å­¦ä¹ ï¼šé€‰æ‹©å•è¯æœ¬ -->
    <div id="pageWordBookSelect" class="page">
      <div class="top-bar">
        <h2>é€‰æ‹©å•è¯æœ¬</h2>
        <button type="button" class="btn" id="btnBackFromBookSelect" onclick="if(window.goBack)window.goBack('btnBackFromBookSelect')">è¿”å›</button>
      </div>
      <div id="wordBookList"></div>
      <p style="margin-top:12px;"><label>é€‰æ‹©: </label><select id="selectWordBook"></select> <button type="button" class="btn" id="btnConfirmWordBook">ç¡®è®¤</button></p>
    </div>

    <!-- å•è¯å¡å­¦ä¹  -->
    <div id="pageWordCard" class="page">
      <div class="top-bar">
        <h2 id="wordCardTitle">å•è¯å­¦ä¹ </h2>
        <button type="button" class="btn" id="btnBackFromWordCard" onclick="if(window.goBack)window.goBack('btnBackFromWordCard')">è¿”å›</button>
      </div>
      <div id="wordCardBox" class="word-card-box">
        <p class="word-en" id="cardWordEn" title="ç‚¹å‡»æœ—è¯»ï¼ˆå®‰å“è¯·è°ƒé«˜åª’ä½“éŸ³é‡ã€ç”¨Chromeæ‰“å¼€ï¼‰">â€”</p>
        <p class="word-phonetic" id="cardWordPhonetic"></p>
        <p class="word-cn" id="cardWordCn">â€”</p>
        <p class="word-memory-tip" id="cardWordMemoryTip"></p>
        <div class="word-actions">
          <button type="button" class="btn" id="btnCardPrev">ä¸Šä¸€ä¸ª</button>
          <button type="button" class="btn" id="btnCardNext">ä¸‹ä¸€ä¸ª</button>
          <button type="button" class="btn" id="btnCardKnown">å·²å­¦ä¼š</button>
        </div>
      </div>
      <p id="wordCardProgress" style="text-align:center;color:var(--text-muted);"></p>
    </div>

    <!-- å·²å­¦ä¹ å•è¯ + é—å¿˜å¤ä¹  -->
    <div id="pageLearned" class="page">
      <div class="top-bar">
        <h2>å·²å­¦ä¹ å•è¯</h2>
        <button type="button" class="btn" id="btnBackFromLearned" onclick="if(window.goBack)window.goBack('btnBackFromLearned')">é€€å‡º</button>
      </div>
      <p style="margin-bottom:12px;"><button type="button" class="btn" id="btnForgetReview">é—å¿˜å¤ä¹ </button></p>
      <div id="learnedWordList"></div>
    </div>

    <!-- é—å¿˜å¤ä¹ ï¼šç¿»å¡ç•Œé¢ -->
    <div id="pageForgetReviewDo" class="page">
      <div class="top-bar">
        <h2>é—å¿˜æ›²çº¿å¤ä¹ </h2>
        <button type="button" class="btn" id="btnBackFromForgetReviewDo" onclick="if(window.goBack)window.goBack('btnBackFromForgetReviewDo')">è¿”å›</button>
      </div>
      <p style="text-align:center;color:var(--text-muted);font-size:14px;margin-bottom:12px;">ç‚¹å‡»ã€Œæˆ‘è¿˜è®°å¾—ã€å¡«å†™ç­”æ¡ˆ Â· æˆ–ç‚¹å‡»å¡ç‰‡ç¿»è½¬æŸ¥çœ‹</p>
      <div class="test-do-progress">
        <span>ç¬¬ <strong id="forgetReviewProgressCurrent">1</strong> / <strong id="forgetReviewProgressTotal">0</strong> å¼ </span>
      </div>
      <div id="forgetReviewCardArea" class="flashcard-container">
        <div id="forgetReviewFlashcard" class="flashcard">
          <div class="flashcard-face flashcard-front">
            <span class="flashcard-prompt" id="forgetReviewFrontText">â€”</span>
            <button type="button" class="btn flashcard-btn-remember" id="btnForgetReviewIRemember">æˆ‘è¿˜è®°å¾—</button>
            <p class="flashcard-memory-tip" id="forgetReviewFrontTip"></p>
          </div>
          <div class="flashcard-face flashcard-back">
            <p class="word-en" id="forgetReviewBackEn" title="ç‚¹å‡»æœ—è¯»ï¼ˆå®‰å“è¯·è°ƒé«˜åª’ä½“éŸ³é‡ã€ç”¨Chromeæ‰“å¼€ï¼‰">â€”</p>
            <p class="word-phonetic" id="forgetReviewBackPhonetic"></p>
            <p class="word-cn" id="forgetReviewBackCn">â€”</p>
            <span class="flashcard-reviewed-label">å·²ç»å¤ä¹ </span>
            <p class="flashcard-memory-tip" id="forgetReviewBackTip"></p>
          </div>
        </div>
      </div>
      <div id="forgetReviewActions" class="flashcard-actions">
        <button type="button" class="btn" id="btnForgetReviewPrev">ä¸Šä¸€ä¸ª</button>
        <button type="button" class="btn" id="btnForgetReviewNext">ä¸‹ä¸€ä¸ª</button>
      </div>
      <div id="forgetReviewFinishWrap" class="flashcard-finish-wrap hide">
        <p style="margin-bottom:12px;">æ­å–œï¼Œå¤ä¹ å®Œæˆï¼</p>
        <button type="button" class="btn" id="btnFinishForgetReview">å®Œæˆå¹¶é¢†å–å¥–åŠ±</button>
      </div>
    </div>

    <!-- é—å¿˜å¤ä¹ å®Œæ¯•ï¼šå±•ç¤ºé‡‘å¸å¹¶ç‚¹å‡»/2ç§’è¿”å›å·²å­¦ä¹ å•è¯ -->
    <div id="pageForgetReviewDone" class="page" style="display:flex;align-items:center;justify-content:center;min-height:60vh;cursor:pointer;">
      <div class="main" style="text-align:center;padding:32px;">
        <p style="font-size:18px;margin-bottom:16px;color:var(--text);">å¤ä¹ å®Œæ¯•</p>
        <p style="font-size:24px;font-weight:600;color:var(--gold);margin-bottom:24px;"><span id="forgetReviewDoneCoins">0</span> é‡‘å¸å·²åˆ°è´¦</p>
        <p style="font-size:13px;color:var(--text-muted);">ç‚¹å‡»ä»»æ„å¤„è¿”å›å·²å­¦ä¹ å•è¯ Â· 2 ç§’åè‡ªåŠ¨è¿”å›</p>
      </div>
    </div>

    <!-- æƒ…æ™¯å¯¹è¯ -->
    <div id="pageScenario" class="page">
      <div class="top-bar">
        <h2>æƒ…æ™¯å¯¹è¯</h2>
        <button type="button" class="btn" id="btnBackFromScenario" onclick="if(window.goBack)window.goBack('btnBackFromScenario')">è¿”å›</button>
      </div>
      <p style="margin-bottom:12px;">é€‰æ‹©æƒ…æ™¯ï¼Œè¾“å…¥ä½ çš„è‹±æ–‡å¥å­ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­æ„æ€æ˜¯å¦å¤§è‡´æ­£ç¡®å¹¶ç»™å‡ºæ›´å¥½è¡¨è¾¾ã€‚</p>
      <label>æƒ…æ™¯</label>
      <select id="scenarioSelect"></select>
      <div id="scenarioPrompt" style="margin:16px 0; padding:12px; background:var(--bg-soft); border-radius:var(--radius);"></div>
      <label>ä½ çš„è‹±æ–‡</label>
      <input type="text" id="scenarioInput" placeholder="è¾“å…¥è‹±æ–‡å¥å­">
      <button type="button" class="btn" id="btnScenarioCheck">æ£€æŸ¥</button>
      <div id="scenarioResult" class="dialogue-result hide"></div>
    </div>

    <!-- å•è¯æµ‹è¯•ï¼šé€‰æ‹© -->
    <div id="pageWordTest" class="page">
      <div class="top-bar">
        <h2>å•è¯æµ‹è¯•</h2>
        <button type="button" class="btn" id="btnBackFromWordTest" onclick="if(window.goBack)window.goBack('btnBackFromWordTest')">è¿”å›</button>
      </div>
      <p>é€‰æ‹©å•è¯æœ¬ï¼Œéšæœº50é¢˜ã€‚</p>
      <select id="wordTestBookSelect"></select>
      <button type="button" class="btn" id="btnWordTestStart">å¼€å§‹æµ‹è¯•</button>
    </div>

    <!-- å•è¯æµ‹è¯•ï¼šç­”é¢˜ç•Œé¢ -->
    <div id="pageWordTestDo" class="page">
      <div class="top-bar">
        <h2>å•è¯æµ‹è¯•</h2>
        <button type="button" class="btn" id="btnBackFromWordTestDo" onclick="if(window.goBack)window.goBack('btnBackFromWordTestDo')">è¿”å›</button>
      </div>
      <div class="test-do-progress">
        <span>å·²ç­” <strong id="wordTestProgressCurrent">0</strong> / <strong id="wordTestProgressTotal">50</strong> é¢˜</span>
        <div class="test-do-progress-bar"><div class="test-do-progress-bar-inner" id="wordTestProgressBar" style="width:0%"></div></div>
      </div>
      <div id="wordTestDoCard" class="test-card-box">
        <p class="test-prompt" id="wordTestDoPrompt">â€”</p>
        <div class="test-input-wrap"><input type="text" id="wordTestDoAnswer" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ"></div>
        <div class="test-card-actions">
          <button type="button" class="btn" id="btnWordTestDoSubmit">æäº¤</button>
          <button type="button" class="btn" id="btnWordTestDoSkip">æˆ‘ä¸ä¼š</button>
        </div>
      </div>
      <div id="wordTestDoResult" class="test-result-summary hide"></div>
    </div>

    <!-- åŸºç¡€å•è¯ï¼šé€‰ç­‰çº§ï¼ˆæ¯ç­‰çº§å»ºè®®è‡³å°‘ 1 ä¸‡è¯ï¼‰ -->
    <div id="pageBasicSelect" class="page">
      <div class="top-bar">
        <h2>åŸºç¡€å•è¯å­¦ä¹ </h2>
        <button type="button" class="btn" id="btnBackFromBasic" onclick="if(window.goBack)window.goBack('btnBackFromBasic')">è¿”å›</button>
      </div>
      <p>é€‰æ‹©ç­‰çº§åè¿›å…¥å•è¯å¡å­¦ä¹ ã€‚<span style="font-size:12px;color:var(--text-muted);">æ¯ç­‰çº§å»ºè®®è‡³å°‘ 1 ä¸‡è¯ï¼Œå½“å‰ä¸ºæ¼”ç¤ºè¯é‡ï¼›å®Œæ•´è¯åº“å¯é€šè¿‡å¤–éƒ¨ JSON åŠ è½½ã€‚</span></p>
      <select id="basicLevelSelect">
        <option value="primary">å°å­¦</option>
        <option value="junior">åˆä¸­</option>
        <option value="senior">é«˜ä¸­</option>
        <option value="university">å¤§å­¦</option>
        <option value="abroad">å‡ºå›½</option>
        <option value="ielts">é›…æ€</option>
        <option value="toefl">æ‰˜ç¦</option>
        <option value="harvard">å“ˆä½›</option>
      </select>
      <button type="button" class="btn" id="btnBasicConfirm">ç¡®è®¤</button>
    </div>

    <!-- è¯æ±‡é‡æ£€æµ‹ï¼šé€‰æ‹© -->
    <div id="pageVocabTest" class="page">
      <div class="top-bar">
        <h2>å•è¯è¯æ±‡é‡æ£€æµ‹</h2>
        <button type="button" class="btn" id="btnBackFromVocabTest" onclick="if(window.goBack)window.goBack('btnBackFromVocabTest')">è¿”å›</button>
      </div>
      <p>50é¢˜ï¼Œæ ¹æ®æ­£ç¡®ç‡å®šçº§ã€‚å·²æœ‰ç­‰çº§åˆ™åˆ¤æ–­æ™‹çº§/é™çº§ã€‚</p>
      <button type="button" class="btn" id="btnVocabTestStart">å¼€å§‹æµ‹è¯•</button>
    </div>

    <!-- è¯æ±‡é‡æ£€æµ‹ï¼šç­”é¢˜ç•Œé¢ -->
    <div id="pageVocabTestDo" class="page">
      <div class="top-bar">
        <h2>å•è¯è¯æ±‡é‡æ£€æµ‹</h2>
        <button type="button" class="btn" id="btnBackFromVocabTestDo" onclick="if(window.goBack)window.goBack('btnBackFromVocabTestDo')">è¿”å›</button>
      </div>
      <div class="test-do-progress">
        <span>å·²ç­” <strong id="vocabTestProgressCurrent">0</strong> / <strong id="vocabTestProgressTotal">50</strong> é¢˜</span>
        <div class="test-do-progress-bar"><div class="test-do-progress-bar-inner" id="vocabTestProgressBar" style="width:0%"></div></div>
      </div>
      <div id="vocabTestDoCard" class="test-card-box">
        <p class="test-prompt" id="vocabTestDoPrompt">â€”</p>
        <div class="test-input-wrap"><input type="text" id="vocabTestDoAnswer" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ"></div>
        <div class="test-card-actions">
          <button type="button" class="btn" id="btnVocabTestDoSubmit">æäº¤</button>
          <button type="button" class="btn" id="btnVocabTestDoSkip">æˆ‘ä¸ä¼š</button>
        </div>
      </div>
      <div id="vocabTestDoResult" class="test-result-summary hide"></div>
    </div>

    <!-- è‹±è¯­é˜…è¯»ï¼šé€‰ç­‰çº§ -->
    <div id="pageReadingSelect" class="page">
      <div class="top-bar">
        <h2>è‹±è¯­é˜…è¯»</h2>
        <button type="button" class="btn" id="btnBackFromReadingSelect" onclick="if(window.goBack)window.goBack('btnBackFromReadingSelect')">è¿”å›</button>
      </div>
      <p>é€‰æ‹©ç­‰çº§åå¼€å§‹éšæœºæ–‡ç« é˜…è¯»ã€‚é˜…è¯»å®Œæ¯•ç‚¹å‡»ã€Œæˆ‘å·²ç»é˜…è¯»å®Œæ¯•ã€è¿›å…¥æµ‹éªŒï¼Œæ­£ç¡®ç‡â‰¥90% å¯è·å¾— 600 é‡‘å¸ã€‚</p>
      <select id="readingLevelSelect">
        <option value="primary">å°å­¦</option>
        <option value="junior">åˆä¸­</option>
        <option value="senior">é«˜ä¸­</option>
        <option value="university">å¤§å­¦</option>
        <option value="abroad">å‡ºå›½</option>
        <option value="ielts">é›…æ€</option>
        <option value="toefl">æ‰˜ç¦</option>
        <option value="harvard">å“ˆä½›</option>
      </select>
      <button type="button" class="btn" id="btnReadingStart">å¼€å§‹é˜…è¯»</button>
    </div>

    <!-- è‹±è¯­é˜…è¯»ï¼šæ–‡ç« é¡µ -->
    <div id="pageReadingArticle" class="page">
      <div class="top-bar">
        <h2 id="readingArticleTitle">â€”</h2>
        <button type="button" class="btn" id="btnBackFromReadingArticle" onclick="if(window.goBack)window.goBack('btnBackFromReadingArticle')">è¿”å›</button>
      </div>
      <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px;">ç‚¹å‡»å•è¯å¯æŸ¥çœ‹å•è¯å¡ï¼Œç‚¹å‡»å¥å­å¯æŸ¥çœ‹è¯¥å¥ç¿»è¯‘ã€‚</p>
      <div id="readingArticleBody" class="reading-article-body"></div>
      <div class="reading-finish-wrap" style="margin-top:24px;padding-top:20px;border-top:1px solid var(--border);">
        <button type="button" class="btn" id="btnReadingFinish">æˆ‘å·²ç»é˜…è¯»å®Œæ¯•</button>
      </div>
    </div>

    <!-- æ¨èå­¦ä¹  -->
    <div id="pageRecommend" class="page">
      <div class="top-bar">
        <h2>æ¨èå­¦ä¹ </h2>
        <button type="button" class="btn" id="btnBackFromRecommend" onclick="if(window.goBack)window.goBack('btnBackFromRecommend')">è¿”å›</button>
      </div>
      <p id="recommendHint">å®Œæˆè¯æ±‡é‡æ£€æµ‹åï¼Œæ ¹æ®ä½ çš„ç­‰çº§æ¨èéœ€è¦å­¦ä¹ çš„å•è¯ã€‚</p>
      <button type="button" class="btn" id="btnRecommendStart">å¼€å§‹å­¦ä¹ </button>
      <div id="recommendCardArea" class="hide"></div>
    </div>

    <!-- ç®¡ç†é¡µï¼ˆä»… Entelchï¼‰ï¼šè´¦æˆ·åˆ—è¡¨ã€ä¿®æ”¹/åˆ é™¤/æ‹‰é»‘ -->
    <div id="pageAdmin" class="page">
      <div class="top-bar">
        <h2>è´¦æˆ·ç®¡ç†</h2>
        <button type="button" class="btn" id="btnBackFromAdmin" onclick="if(window.goBackToHome)window.goBackToHome()">è¿”å›</button>
      </div>
      <p class="login-gate-tip" style="margin-bottom:12px;">ä»…ç®¡ç†å‘˜ Entelch å¯æ“ä½œã€‚å¯ä¿®æ”¹å¯†ç ã€åˆ é™¤è´¦æˆ·æˆ–æ‹‰å…¥é»‘åå•ï¼ˆå†»ç»“åéœ€ç®¡ç†å‘˜å–æ¶ˆé»‘åå•æ‰èƒ½ç™»å½•ï¼‰ã€‚</p>
      <div id="adminAccountList"></div>
    </div>
  </main>

  <!-- å•†åŸå¼¹çª— -->
  <div id="modalMall" class="modal-overlay hide">
    <div class="modal-box" style="max-width:420px;">
      <button type="button" class="modal-close" id="modalMallClose">Ã—</button>
      <h3>å•†åŸ</h3>
      <p>æˆ‘çš„é‡‘å¸ï¼š<strong class="coins" id="mallCoins">0</strong></p>
      <div id="mallProductList"></div>
    </div>
  </div>

  <!-- å•†å“èµ„æ–™å¡å¼¹çª—ï¼ˆä¸æ¸¸æˆå†…èµ„æ–™å¡ä¸€è‡´ï¼‰ -->
  <div id="modalProductCard" class="modal-overlay hide">
    <div class="modal-box product-card-box">
      <button type="button" class="modal-close" id="modalProductCardClose">Ã—</button>
      <h3 class="product-card-title" id="productCardName">â€”</h3>
      <div class="product-card-header">
        <div class="product-card-img" id="productCardImg">â€”</div>
        <div class="product-card-meta">
          <div class="product-card-row">
            <span class="maturity-label">é‡‘å¸</span>
            <span class="coins" id="productCardCoins">0</span>
          </div>
          <div class="product-card-row">
            <span class="maturity-label">æˆç†Ÿåº¦</span>
            <span id="productCardMaturity">0/0</span>
          </div>
        </div>
      </div>
      <div class="product-card-section">
        <h4>åŠŸèƒ½</h4>
        <p id="productCardFunc">â€”</p>
      </div>
      <div class="product-card-section">
        <h4>æè¿°</h4>
        <p id="productCardDesc">â€”</p>
      </div>
    </div>
  </div>

  <!-- é‡‘å¸ä¸è¶³æç¤ºï¼ˆ0.5ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼‰ -->
  <div id="toastMallNotEnough" class="toast-mall">é‡‘å¸æ•°é‡ä¸å¤Ÿ</div>

  <!-- æœç´¢/ç¿»è¯‘å¼¹çª— -->
  <div id="modalSearch" class="modal-overlay hide">
    <div class="modal-box" style="max-width:520px;">
      <button type="button" class="modal-close" id="modalSearchClose">Ã—</button>
      <h3>æœç´¢ / ç¿»è¯‘</h3>
      <p style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">è¾“å…¥å•è¯æˆ–å¥å­ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰ï¼Œå®æ—¶è‡ªåŠ¨ç¿»è¯‘ã€‚</p>
      <textarea id="searchInput" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„å•è¯æˆ–å¥å­â€¦" rows="3" style="width:100%;margin-bottom:12px;resize:vertical;"></textarea>
      <div style="margin-top:16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <strong>ç¿»è¯‘ç»“æœ</strong>
          <button type="button" id="btnReadTranslation" title="æœ—è¯»ç¿»è¯‘ç»“æœ" style="background:none;border:none;cursor:pointer;font-size:18px;padding:0;line-height:1;color:var(--text-muted);" aria-label="æœ—è¯»">ğŸ”Š</button>
        </div>
        <div id="searchResult" style="padding:12px;background:var(--bg-soft);border-radius:var(--radius);min-height:40px;line-height:1.6;"></div>
      </div>
    </div>
  </div>

  <!-- å•è¯å¡å¼¹çª—ï¼ˆå«éŸ³æ ‡ï¼‰ -->
  <div id="modalLetterCard" class="modal-overlay hide">
    <div class="modal-box word-card-box" style="max-width:360px;">
      <button type="button" class="modal-close" id="modalLetterCardClose">Ã—</button>
      <p class="word-en" id="letterCardEn" title="ç‚¹å‡»æœ—è¯»ï¼ˆå®‰å“è¯·è°ƒé«˜åª’ä½“éŸ³é‡ã€ç”¨Chromeæ‰“å¼€ï¼‰" style="font-size:28px;cursor:pointer;">â€”</p>
      <p class="word-phonetic" id="letterCardPhonetic" style="min-height:1.2em;color:var(--text-muted);">â€”</p>
      <p class="word-cn" id="letterCardCn">â€”</p>
      <div class="word-actions" style="margin-top:16px;">
        <button type="button" class="btn" id="btnLetterCardKnown">å·²å­¦ä¼š</button>
      </div>
    </div>
  </div>

  <!-- è‹±è¯­é˜…è¯»ï¼šæµ‹éªŒå¼¹çª—ï¼ˆABCD é€‰æ‹©é¢˜ï¼‰ -->
  <div id="modalReadingQuiz" class="modal-overlay hide">
    <div class="modal-box" style="max-width:520px;max-height:85vh;overflow-y:auto;">
      <button type="button" class="modal-close" id="modalReadingQuizClose">Ã—</button>
      <h3>é˜…è¯»æµ‹éªŒ</h3>
      <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px;">å…± 5 é¢˜ï¼Œæ ¹æ®æ–‡ç« å†…å®¹é€‰æ‹©æ­£ç¡®ç­”æ¡ˆã€‚å…¨éƒ¨æ­£ç¡®å¯è·å¾— 600 é‡‘å¸ï¼Œæäº¤åå¯æŸ¥çœ‹æ¯é¢˜å¯¹é”™ä¸è®²è§£ã€‚</p>
      <div id="readingQuizQuestions"></div>
      <div style="margin-top:16px;">
        <button type="button" class="btn" id="btnReadingQuizSubmit">æäº¤ç­”æ¡ˆ</button>
      </div>
    </div>
  </div>

  <!-- è‹±è¯­é˜…è¯»ï¼šæµ‹éªŒç»“æœå¼¹çª—ï¼ˆå«æ¯é¢˜å¯¹é”™ä¸è®²è§£ï¼‰ -->
  <div id="modalReadingResult" class="modal-overlay hide">
    <div class="modal-box" style="max-width:560px;max-height:85vh;overflow-y:auto;">
      <button type="button" class="modal-close" id="modalReadingResultClose">Ã—</button>
      <h3 id="readingResultTitle">æµ‹éªŒç»“æœ</h3>
      <div id="readingResultText" style="margin:12px 0;max-height:60vh;overflow-y:auto;"></div>
      <p id="readingResultCoins" class="hide" style="color:var(--gold);font-weight:600;"></p>
      <button type="button" class="btn" id="btnReadingResultOK">ç¡®å®š</button>
    </div>
  </div>

  <!-- è‹±è¯­é˜…è¯»ï¼šå¥å­ç¿»è¯‘å¼¹çª— -->
  <div id="modalSentence" class="modal-overlay hide">
    <div class="modal-box" style="max-width:480px;">
      <button type="button" class="modal-close" id="modalSentenceClose">Ã—</button>
      <h3>å¥å­ç¿»è¯‘</h3>
      <p id="sentenceEn" style="margin:8px 0;font-style:italic;color:var(--text);"></p>
      <p id="sentenceCn" style="margin:8px 0;color:var(--accent);"></p>
    </div>
  </div>

  <!-- è´¦æˆ·å¼¹çª—ï¼šé€€å‡ºã€ç®¡ç†ï¼ˆä»… Entelchï¼‰ -->
  <!-- é—å¿˜å¤ä¹ ï¼šæˆ‘è¿˜è®°å¾— - å¡«å†™ç­”æ¡ˆå¼¹çª— -->
  <div id="modalForgetRecall" class="modal-overlay hide">
    <div class="modal-box">
      <button type="button" class="modal-close" id="modalForgetRecallClose">Ã—</button>
      <h3 id="modalForgetRecallTitle">å¡«å†™å¯¹åº”æ„æ€</h3>
      <p id="modalForgetRecallPrompt" style="margin-bottom:12px;color:var(--text-muted);font-size:14px;"></p>
      <input type="text" id="modalForgetRecallInput" placeholder="è¯·è¾“å…¥">
      <p id="modalForgetRecallError" class="gate-reg-error" style="display:none;margin-top:8px;"></p>
      <div style="margin-top:16px;display:flex;gap:10px;">
        <button type="button" class="btn" id="btnForgetRecallSubmit">æäº¤</button>
        <button type="button" class="btn" id="btnForgetRecallCancel">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <div id="modalAccount" class="modal-overlay hide">
    <div class="modal-box">
      <button type="button" class="modal-close" id="modalAccountClose">Ã—</button>
      <h3>è´¦æˆ·</h3>
      <p>å½“å‰ï¼š<strong id="accountModalUser">â€”</strong></p>
      <div class="account-modal-actions">
        <button type="button" class="btn" id="accountModalLogout">é€€å‡º</button>
        <button type="button" class="btn" id="accountModalManage" style="display:none" onclick="if(window.openAdminPage)window.openAdminPage()">ç®¡ç†</button>
      </div>
    </div>
  </div>

  <!-- è´¦æˆ·å¼¹çª—ï¼šä¸ä¾èµ– app.js ä¹Ÿèƒ½æ‰“å¼€ -->
  <script>
  (function(){
    function openAccountModal(){
      var acc={}; try{ acc=JSON.parse(sessionStorage.getItem('mech_account')||'{}'); }catch(e){}
      var u=acc.username||'æœªç™»å½•';
      var userEl=document.getElementById('accountModalUser');
      var manageEl=document.getElementById('accountModalManage');
      var modal=document.getElementById('modalAccount');
      if(userEl) userEl.textContent=u;
      if(manageEl) manageEl.style.display=(u==='Entelch')?'':'none';
      if(modal) modal.classList.remove('hide');
    }
    function doLogout(){
      try{ sessionStorage.removeItem('mech_account'); }catch(e){}
      var header=document.getElementById('appHeader');
      if(header) header.style.display='none';
      document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
      var gate=document.getElementById('pageLoginGate');
      if(gate) gate.classList.add('active');
      var modal=document.getElementById('modalAccount');
      if(modal) modal.classList.add('hide');
      var u=document.getElementById('gateUsername'); if(u) u.value='';
      var p=document.getElementById('gatePassword'); if(p) p.value='';
      var ru=document.getElementById('gateRegUsername'); if(ru) ru.value='';
      var rp=document.getElementById('gateRegPassword'); if(rp) rp.value='';
      var rpc=document.getElementById('gateRegPasswordConfirm'); if(rpc) rpc.value='';
      var loginForm=document.getElementById('gateLoginForm'); var regForm=document.getElementById('gateRegisterForm');
      if(loginForm) loginForm.classList.remove('hide'); if(regForm) regForm.classList.add('hide');
    }
    function fillAdminListFallback(){
      var listEl=document.getElementById('adminAccountList');
      if(!listEl) return;
      var raw=localStorage.getItem('mech_accounts')||'{}';
      var accounts={}; try{ accounts=JSON.parse(raw); }catch(e){}
      var blRaw=localStorage.getItem('mech_blacklist')||'[]';
      var blacklist=[]; try{ blacklist=JSON.parse(blRaw); }catch(e){}
      var html='';
      function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;'); }
      Object.keys(accounts).forEach(function(username){
        var pwd=accounts[username];
        var userKey='mech_user_'+username;
        var data={}; try{ var d=localStorage.getItem(userKey); if(d) data=JSON.parse(d); }catch(e){}
        var signInDays=data.signInDays!=null?data.signInDays:0;
        var studyMs=data.studyMsToday!=null?data.studyMsToday:0;
        var ms=Math.floor(studyMs/60000); var s=Math.floor((studyMs%60000)/1000);
        var studyStr=ms+'åˆ†'+s+'ç§’';
        var vocabLevel=data.vocabLevel||'æœªæ£€æµ‹';
        var coins=data.coins!=null?data.coins:0;
        var frozen=blacklist.indexOf(username)>=0;
        var uAttr=esc(username);
        html+='<div class="admin-account-item'+(frozen?' frozen':'')+'"><h4>è´¦æˆ·ï¼š'+username+(frozen?' <span style="color:#c45c4a;">(å·²å†»ç»“)</span>':'')+'</h4>';
        html+='<p class="admin-stats">å¯†ç ï¼š'+pwd+' | è¿ç»­ç­¾åˆ°ï¼š'+signInDays+' å¤© | ä»Šæ—¥å­¦ä¹ ï¼š'+studyStr+' | è¯æ±‡é‡ï¼š'+vocabLevel+' | é‡‘å¸ï¼š'+coins+'</p>';
        html+='<div class="admin-actions"><button type="button" class="btn" data-user="'+uAttr+'" onclick="window.adminEditPwd(this.getAttribute(\'data-user\'))">ä¿®æ”¹å¯†ç </button>';
        html+='<button type="button" class="btn" data-user="'+uAttr+'" onclick="window.adminDeleteAccount(this.getAttribute(\'data-user\'))">åˆ é™¤è´¦æˆ·</button>';
        if(frozen) html+='<button type="button" class="btn" data-user="'+uAttr+'" onclick="window.adminUnblacklist(this.getAttribute(\'data-user\'))">å–æ¶ˆé»‘åå•</button>';
        else html+='<button type="button" class="btn" data-user="'+uAttr+'" onclick="window.adminBlacklist(this.getAttribute(\'data-user\'))">æ‹‰å…¥é»‘åå•</button>';
        html+='</div></div>';
      });
      listEl.innerHTML=html||'<p class="login-gate-tip">æš‚æ— è´¦æˆ·</p>';
    }
    function adminEditPwd(username){
      if(!username) return;
      var newPwd=prompt('è¾“å…¥æ–°å¯†ç ï¼ˆä»…è‹±æ–‡ã€æ•°å­—ï¼‰','');
      if(newPwd==null) return;
      if(!/^[a-zA-Z0-9]+$/.test(newPwd)){ alert('å¯†ç åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯å’Œæ•°å­—'); return; }
      var raw=localStorage.getItem('mech_accounts')||'{}';
      var accounts={}; try{ accounts=JSON.parse(raw); }catch(e){}
      if(!accounts[username]) return;
      accounts[username]=newPwd;
      localStorage.setItem('mech_accounts',JSON.stringify(accounts));
      fillAdminListFallback();
      alert('å·²ä¿®æ”¹');
    }
    function adminDeleteAccount(username){
      if(!username) return;
      if(!confirm('ç¡®å®šåˆ é™¤è´¦æˆ· '+username+'ï¼Ÿåˆ é™¤åè¯¥è´¦å·å°†æ— æ³•å†ç™»å½•ã€‚')) return;
      var raw=localStorage.getItem('mech_accounts')||'{}';
      var accounts={}; try{ accounts=JSON.parse(raw); }catch(e){}
      var pwd=accounts[username];
      function doLocalDelete(){
        delete accounts[username];
        localStorage.setItem('mech_accounts',JSON.stringify(accounts));
        try{ localStorage.removeItem('mech_user_'+username); }catch(e){}
        fillAdminListFallback();
        alert('å·²åˆ é™¤');
      }
      var apiBase=(window.location.origin||'')+'/api';
      if(!apiBase||!pwd){ doLocalDelete(); return; }
      fetch(apiBase+'/sync',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({username:username,password:pwd,deleteAccount:true})
      }).then(function(r){ return r.json().then(function(j){ return {ok:r.ok,json:j}; }); })
        .then(function(result){
          if(result.ok&&result.json.deleted){ doLocalDelete(); }
          else{ alert('äº‘ç«¯åˆ é™¤å¤±è´¥ï¼š'+(result.json&&result.json.error?result.json.error:'è¯·ç¨åé‡è¯•')); }
        })
        .catch(function(){ alert('äº‘ç«¯åˆ é™¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•'); });
    }
    function adminBlacklist(username){
      if(!username) return;
      if(!confirm('ç¡®å®šå°† '+username+' æ‹‰å…¥é»‘åå•ï¼Ÿè¯¥ç”¨æˆ·å°†è¢«è¸¢å‡ºå¹¶æ— æ³•ç™»å½•ç›´è‡³å–æ¶ˆé»‘åå•ã€‚')) return;
      var blRaw=localStorage.getItem('mech_blacklist')||'[]';
      var blacklist=[]; try{ blacklist=JSON.parse(blRaw); }catch(e){}
      if(blacklist.indexOf(username)<0) blacklist.push(username);
      localStorage.setItem('mech_blacklist',JSON.stringify(blacklist));
      var accRaw=sessionStorage.getItem('mech_account')||'{}';
      var acc={}; try{ acc=JSON.parse(accRaw); }catch(e){}
      if(acc.username===username){
        sessionStorage.removeItem('mech_account');
        var header=document.getElementById('appHeader'); if(header) header.style.display='none';
        document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
        document.getElementById('pageLoginGate').classList.add('active');
      }
      fillAdminListFallback();
      alert('å·²æ‹‰å…¥é»‘åå•');
    }
    function adminUnblacklist(username){
      if(!username) return;
      var blRaw=localStorage.getItem('mech_blacklist')||'[]';
      var blacklist=[]; try{ blacklist=JSON.parse(blRaw); }catch(e){}
      blacklist=blacklist.filter(function(u){ return u!==username; });
      localStorage.setItem('mech_blacklist',JSON.stringify(blacklist));
      fillAdminListFallback();
      alert('å·²å–æ¶ˆé»‘åå•');
    }
    function openAdminPage(){
      var modal=document.getElementById('modalAccount');
      if(modal) modal.classList.add('hide');
      document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
      var admin=document.getElementById('pageAdmin');
      if(admin) admin.classList.add('active');
      var listEl=document.getElementById('adminAccountList');
      if(!listEl) return;
      if(typeof window.fillAdminList==='function'){ window.fillAdminList(); return; }
      fillAdminListFallback();
    }
    window.adminEditPwd=adminEditPwd;
    window.adminDeleteAccount=adminDeleteAccount;
    window.adminBlacklist=adminBlacklist;
    window.adminUnblacklist=adminUnblacklist;
    function goBackToHome(){
      document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
      var home=document.getElementById('pageHome');
      if(home) home.classList.add('active');
    }
    window.openAccountModal=openAccountModal;
    window.doLogout=doLogout;
    window.openAdminPage=openAdminPage;
    window.goBackToHome=goBackToHome;
    function initLoginState(){
      var acc={}; try{ acc=JSON.parse(sessionStorage.getItem('mech_account')||'{}'); }catch(e){}
      var header=document.getElementById('appHeader');
      document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
      if(acc&&acc.username){
        if(header) header.style.display='';
        var home=document.getElementById('pageHome'); if(home) home.classList.add('active');
      }else{
        if(header) header.style.display='none';
        var gate=document.getElementById('pageLoginGate'); if(gate) gate.classList.add('active');
      }
    }
    window.initLoginState=initLoginState;
    var backTargetMap={
      'btnBackFromBookSelect':'pageHome',
      'btnBackFromWordCard':'pageWordBookSelect',
      'btnBackFromLearned':'pageHome',
      'btnBackFromForgetReviewDo':'pageLearned',
      'btnBackFromScenario':'pageHome',
      'btnBackFromWordTest':'pageHome',
      'btnBackFromWordTestDo':'pageWordTest',
      'btnBackFromBasic':'pageHome',
      'btnBackFromVocabTest':'pageHome',
      'btnBackFromVocabTestDo':'pageVocabTest',
      'btnBackFromReadingSelect':'pageHome',
      'btnBackFromReadingArticle':'pageReadingSelect',
      'btnBackFromRecommend':'pageHome'
    };
    function goBack(btnId){
      var target=backTargetMap[btnId];
      if(!target) return;
      document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
      var page=document.getElementById(target);
      if(page) page.classList.add('active');
    }
    window.goBack=goBack;
    function fillWordBookSelectFallback(selectId){
      var sel=document.getElementById(selectId);
      if(!sel) return;
      sel.innerHTML='<option value="25å¹´å›½é›†è®­1è½®å•è¯">25å¹´å›½é›†è®­1è½®å•è¯</option>';
    }
    function bindModuleClicks(){
      var grid=document.getElementById('mainGrid');
      if(!grid) return;
      grid.addEventListener('click',function(e){
        var card=e.target.closest('.module-card');
        if(!card) return;
        var mod=card.getAttribute('data-module');
        if(!mod) return;
        var pageMap={ wordLearn:'pageWordBookSelect', scenario:'pageScenario', wordTest:'pageWordTest', basicWord:'pageBasicSelect', vocabTest:'pageVocabTest', recommend:'pageRecommend', reading:'pageReadingSelect' };
        var pageId=pageMap[mod];
        if(pageId){
          document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
          var page=document.getElementById(pageId);
          if(page) page.classList.add('active');
          if(mod==='wordLearn'){
            if(typeof window.fillWordBookSelect==='function') window.fillWordBookSelect('selectWordBook');
            else fillWordBookSelectFallback('selectWordBook');
          }
          if(mod==='wordTest'){
            if(typeof window.fillWordBookSelect==='function') window.fillWordBookSelect('wordTestBookSelect');
            else fillWordBookSelectFallback('wordTestBookSelect');
          }
        }
        if(window.onModuleEnter) window.onModuleEnter(mod);
      });
    }
    document.addEventListener('DOMContentLoaded',function(){
      initLoginState();
      bindModuleClicks();
      var logoutBtn=document.getElementById('accountModalLogout');
      var closeBtn=document.getElementById('modalAccountClose');
      if(logoutBtn) logoutBtn.onclick=doLogout;
      if(closeBtn) closeBtn.onclick=function(){ var m=document.getElementById('modalAccount'); if(m) m.classList.add('hide'); };
    });
    if(document.readyState!=='loading'){ initLoginState(); bindModuleClicks(); }
  })();
  </script>
  <script src="data.js"></script>
  <script src="app.js"></script>
</body>
</html>
